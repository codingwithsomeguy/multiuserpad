import redis
from base64 import b64decode


# TODO: allow each session to have their own wb / resources
REDIS_WB_KEY = "wb0"


def get_redis_connection():
    # TODO: extract connection settings, memoize
    r = redis.Redis(host="localhost", port=6379, db=0)
    return r


def update_redis_wb(image_data):
    redis_wb_new_key = REDIS_WB_KEY + "new"
    r = get_redis_connection()
    r.set(redis_wb_new_key, image_data)
    r.rename(redis_wb_new_key, REDIS_WB_KEY)


def get_redis_wb():
    r = get_redis_connection()
    return r.get(REDIS_WB_KEY)


default_wb_image = b64decode(
    """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
3pf2xfV/IIK5iv3Ge68AAAAASUVORK5CYII="""
)
